<?xml version="1.0" encoding="UTF-8"?>
<metaschema-meta-constraints xmlns="http://csrc.nist.gov/ns/oscal/metaschema/1.0"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
    <!-- ============================== -->
    <!-- FedRAMP Constraint Style guide -->
    <!-- ============================== -->
    <context>
        <metapath target="/metaschema-meta-constraints//allowed-values"/>
        <constraints>
            <expect id="allowed-value-has-help-url" target="." test="count(prop[@ns='https://docs.oasis-open.org/sarif/sarif/v2.1.0' and @name='help-url']) eq 1" level="ERROR">
                <formal-name>Allowed Values Have Help URL</formal-name>
                <prop namespace="https://docs.oasis-open.org/sarif/sarif/v2.1.0" name="help-url" value="https://github.com/GSA/fedramp-automation/blob/master/src/validations/rules/README.md#frr4"/>
                <message>A FedRAMP constraint MUST define a help URL for allowed values.</message>
            </expect>
        </constraints>
    </context>

    <context>
        <metapath target="/metaschema-meta-constraints//expect"/>
        <constraints>
            <expect id="expect-has-help-url" target="." test="count(prop[@ns='https://docs.oasis-open.org/sarif/sarif/v2.1.0' and @name='help-url']) eq 1" level="ERROR">
                <formal-name>Expect Constraint Has Help URL</formal-name>
                <prop namespace="https://docs.oasis-open.org/sarif/sarif/v2.1.0" name="help-url" value="https://github.com/GSA/fedramp-automation/blob/master/src/validations/rules/README.md#frr4"/>
                <message>A FedRAMP constraint MUST define a help URL.</message>
            </expect>
            <expect id="expect-has-message" target="." test="message" level="ERROR">
                <formal-name>Expect Constraint Has Message</formal-name>
                <prop namespace="https://docs.oasis-open.org/sarif/sarif/v2.1.0" name="help-url" value="https://github.com/GSA/fedramp-automation/blob/master/src/validations/rules/README.md#frr9"/>
                <message>A FedRAMP constraint MUST include a message describing the requirement.</message>
            </expect>
            <expect id="expect-has-formal-name" target="." test="formal-name" level="ERROR">
                <formal-name>Expect Constraint Has Formal Name</formal-name>
                <prop namespace="https://docs.oasis-open.org/sarif/sarif/v2.1.0" name="help-url" value="https://github.com/GSA/fedramp-automation/blob/master/src/validations/rules/README.md#frr16"/>
                <message>A FedRAMP constraint MUST include a formal name.</message>
            </expect>
        </constraints>
    </context>

    <!-- 
    //TODO following-sibling is not implimented in metapath
    //TODO could be done with for every & positional context
    
    <context>
        <metapath target="/metaschema-meta-constraints/context"/>
        <constraints>
            <expect id="constraints-sorted-alphabetically" target="." 
            test="not(//expect[@id > following-sibling::expect[1]/@id])" 
            level="ERROR">
                <formal-name>Constraints Sorted Alphabetically</formal-name>
                <message>
                    A FedRAMP constraint context SHOULD have its constraints sorted alphabetically by their IDs.
                </message>
            </expect>
    </constraints>
    </context> -->
</metaschema-meta-constraints>